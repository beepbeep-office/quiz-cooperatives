<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>G√®nes Diffusion ‚Äì Quiz Live</title>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<style>
  :root {
    --navy: #003366;
    --gold: #C5A059;
    --gold-light: #e0c47a;
    --navy-light: #0a4a8a;
    --white: #ffffff;
    --gray-light: #f4f6fa;
    --gray: #e0e4ed;
    --text: #1a2a4a;
    --correct: #1d7a4e;
    --correct-bg: #e6f7ef;
    --wrong: #b52a2a;
    --wrong-bg: #fdecea;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'Open Sans', sans-serif;
    background: var(--gray-light);
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
  }

  /* ‚îÄ‚îÄ‚îÄ HEXAGON BACKGROUND ‚îÄ‚îÄ‚îÄ */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse at 10% 20%, rgba(0,51,102,0.08) 0%, transparent 60%),
      radial-gradient(ellipse at 90% 80%, rgba(197,160,89,0.10) 0%, transparent 60%);
    pointer-events: none;
    z-index: 0;
  }

  .hex-bg { position: fixed; inset: 0; overflow: hidden; pointer-events: none; z-index: 0; }
  .hex-bg svg { position: absolute; opacity: 0.04; }

  /* ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ */
  .card {
    position: relative;
    z-index: 1;
    background: var(--white);
    border-radius: 20px;
    box-shadow: 0 8px 48px rgba(0,51,102,0.13), 0 2px 8px rgba(0,0,0,0.06);
    width: 92%;
    max-width: 820px;
    padding: 48px 52px;
    animation: fadeUp 0.45s cubic-bezier(.4,0,.2,1) both;
  }
  
  /* Variante pour le mode Host (Plein √©cran PPT) */
  .card.host-mode {
    max-width: 1100px;
    padding: 40px;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(28px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* ‚îÄ‚îÄ‚îÄ LOGO / HEADER ‚îÄ‚îÄ‚îÄ */
 / .logo-area { display: flex; align-items: center; gap: 18px; margin-bottom: 32px; }
 / .hex-logo { width: 56px; height: 56px; flex-shrink: 0; }
  .logo-area { display: flex; align-items: center; gap: 18px; margin-bottom: 32px; }
  .brand-logo { width: 75px; height: auto; max-height: 75px; flex-shrink: 0; object-fit: contain; }
  .brand-text { display: flex; flex-direction: column; line-height: 1.1; }
  .brand-genes { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 22px; color: var(--navy); letter-spacing: 1px; }
  .brand-diffusion { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 18px; color: var(--gold); letter-spacing: 2px; }
  .brand-tagline { font-size: 10px; color: #7a8aaa; letter-spacing: 1.5px; text-transform: uppercase; margin-top: 2px; }

  /* ‚îÄ‚îÄ‚îÄ SCREEN TITLES ‚îÄ‚îÄ‚îÄ */
  .screen-title { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: clamp(22px, 4vw, 34px); color: var(--navy); line-height: 1.2; }
  .screen-subtitle { color: var(--gold); font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: clamp(14px, 2.5vw, 18px); margin-top: 6px; margin-bottom: 28px; }

  /* ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ */
  .progress-wrap { margin-bottom: 28px; }
  .progress-label { display: flex; justify-content: space-between; font-size: 13px; color: #7a8aaa; margin-bottom: 8px; font-family: 'Montserrat', sans-serif; font-weight: 600; }
  .progress-bar { height: 8px; background: var(--gray); border-radius: 10px; overflow: hidden; }
  .progress-fill { height: 100%; background: linear-gradient(90deg, var(--navy), var(--gold)); border-radius: 10px; transition: width 0.5s cubic-bezier(.4,0,.2,1); }

  /* ‚îÄ‚îÄ‚îÄ QUESTION & OPTIONS ‚îÄ‚îÄ‚îÄ */
  .question-text { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: clamp(17px, 2.8vw, 22px); color: var(--text); margin-bottom: 28px; line-height: 1.4; border-left: 5px solid var(--gold); padding-left: 16px; }
  .options { display: flex; flex-direction: column; gap: 14px; margin-bottom: 28px; }
  .option-btn { display: flex; align-items: center; gap: 16px; background: var(--gray-light); border: 2.5px solid var(--gray); border-radius: 14px; padding: 18px 22px; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: clamp(14px, 2.2vw, 17px); color: var(--text); cursor: pointer; text-align: left; transition: all 0.2s ease; width: 100%; line-height: 1.35; }
  .option-btn:hover:not(:disabled) { border-color: var(--navy); background: rgba(0,51,102,0.05); transform: translateX(4px); }
  .option-label { display: inline-flex; align-items: center; justify-content: center; width: 34px; height: 34px; min-width: 34px; background: var(--navy); color: var(--white); border-radius: 8px; font-weight: 800; font-size: 15px; }
  
  .option-btn.correct { background: var(--correct-bg); border-color: var(--correct); color: var(--correct); }
  .option-btn.correct .option-label { background: var(--correct); }
  .option-btn.wrong { background: var(--wrong-bg); border-color: var(--wrong); color: var(--wrong); }
  .option-btn.wrong .option-label { background: var(--wrong); }
  .option-btn:disabled { cursor: default; }

  /* ‚îÄ‚îÄ‚îÄ TRUE/FALSE ‚îÄ‚îÄ‚îÄ */
  .tf-options { display: flex; gap: 16px; margin-bottom: 28px; }
  .tf-btn { flex: 1; padding: 22px; border-radius: 14px; border: 2.5px solid var(--gray); background: var(--gray-light); font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: clamp(16px, 2.5vw, 20px); color: var(--text); cursor: pointer; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; gap: 10px; }
  .tf-btn:hover:not(:disabled) { border-color: var(--navy); background: rgba(0,51,102,0.05); transform: translateY(-2px); }
  .tf-btn.correct { background: var(--correct-bg); border-color: var(--correct); color: var(--correct); }
  .tf-btn.wrong { background: var(--wrong-bg); border-color: var(--wrong); color: var(--wrong); }
  .tf-btn:disabled { cursor: default; }

  /* ‚îÄ‚îÄ‚îÄ FEEDBACK ‚îÄ‚îÄ‚îÄ */
  .feedback-box { border-radius: 14px; padding: 18px 22px; margin-bottom: 24px; font-size: clamp(14px, 2vw, 16px); display: none; animation: fadeUp 0.3s ease both; }
  .feedback-box.show { display: block; }
  .feedback-box.correct-fb { background: var(--correct-bg); border-left: 5px solid var(--correct); color: #135c38; }
  .feedback-box.wrong-fb { background: var(--wrong-bg); border-left: 5px solid var(--wrong); color: #8b1c1c; }
  .feedback-title { font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 16px; margin-bottom: 6px; display: flex; align-items: center; gap: 8px; }

  /* ‚îÄ‚îÄ‚îÄ INPUT NOM JOUEUR (AJOUT) ‚îÄ‚îÄ‚îÄ */
  .name-input-container { margin: 20px 0; }
  .name-input { width: 100%; padding: 18px 22px; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 16px; border: 2.5px solid var(--gray); border-radius: 14px; background: var(--gray-light); color: var(--text); outline: none; transition: all 0.2s ease; }
  .name-input:focus { border-color: var(--navy); background: var(--white); box-shadow: 0 4px 12px rgba(0,51,102,0.1); }

  /* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
  .btn-primary { background: linear-gradient(135deg, var(--navy), var(--navy-light)); color: var(--white); border: none; border-radius: 14px; padding: 18px 40px; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: clamp(15px, 2.2vw, 18px); cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 10px; letter-spacing: 0.5px; box-shadow: 0 4px 16px rgba(0,51,102,0.25); min-width: 220px; justify-content: center; }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,51,102,0.35); }
  .btn-gold { background: linear-gradient(135deg, var(--gold), var(--gold-light)); color: var(--navy); border: none; border-radius: 14px; padding: 18px 40px; font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: clamp(15px, 2.2vw, 18px); cursor: pointer; transition: all 0.2s ease; display: inline-flex; align-items: center; gap: 10px; letter-spacing: 0.5px; box-shadow: 0 4px 16px rgba(197,160,89,0.35); min-width: 220px; justify-content: center; }
  .btn-gold:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(197,160,89,0.5); }
  .btn-row { display: flex; gap: 16px; flex-wrap: wrap; }

  /* ‚îÄ‚îÄ‚îÄ HOME SCREEN ‚îÄ‚îÄ‚îÄ */
  .home-hero { display: flex; align-items: center; justify-content: space-between; gap: 32px; flex-wrap: wrap; }
  .home-content { flex: 1; min-width: 240px; }
  .home-badge { display: inline-flex; align-items: center; gap: 8px; background: rgba(197,160,89,0.12); border: 1.5px solid var(--gold); border-radius: 30px; padding: 7px 18px; color: var(--gold); font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: 12px; letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 18px; }
  .home-meta { display: flex; gap: 24px; margin: 24px 0 20px; flex-wrap: wrap; }
  .home-meta-item { display: flex; align-items: center; gap: 8px; font-size: 14px; color: #7a8aaa; font-family: 'Montserrat', sans-serif; font-weight: 600; }
  .home-meta-item svg { color: var(--gold); }
  .home-hex { flex-shrink: 0; }

  /* ‚îÄ‚îÄ‚îÄ FINAL SCREEN ‚îÄ‚îÄ‚îÄ */
  .score-circle { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 160px; height: 160px; margin: 0 auto 28px; position: relative; }
  .score-circle svg { position: absolute; inset: 0; width: 100%; height: 100%; transform: rotate(-90deg); }
  .score-number { font-family: 'Montserrat', sans-serif; font-weight: 800; font-size: 42px; color: var(--navy); position: relative; z-index: 1; line-height: 1; }
  .score-total { font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 16px; color: var(--gold); position: relative; z-index: 1; }
  .score-message { text-align: center; font-family: 'Montserrat', sans-serif; font-weight: 700; font-size: clamp(16px, 2.5vw, 22px); color: var(--navy); margin-bottom: 6px; }
  .score-sub { text-align: center; color: #7a8aaa; font-size: 14px; margin-bottom: 32px; }

  /* ‚îÄ‚îÄ‚îÄ LEADERBOARD HOST (AJOUT) ‚îÄ‚îÄ‚îÄ */
  .host-layout { display: flex; gap: 40px; align-items: flex-start; }
  .host-leaderboard { flex: 2; }
  .host-qr { flex: 1; background: var(--gray-light); padding: 30px; border-radius: 20px; text-align: center; border: 2px solid var(--gray); }
  .host-qr img { width: 100%; max-width: 200px; border-radius: 10px; margin-bottom: 15px; }
  .host-qr p { font-family: 'Montserrat', sans-serif; font-weight: 700; color: var(--navy); }
  
  .rank-item { display: flex; align-items: center; justify-content: space-between; padding: 15px 20px; margin-bottom: 12px; background: var(--gray-light); border-radius: 12px; font-family: 'Montserrat', sans-serif; font-weight: 600; font-size: 18px; color: var(--navy); }
  .rank-item.top-1 { background: rgba(197,160,89,0.15); border: 2px solid var(--gold); }
  .rank-pos { width: 40px; font-weight: 800; color: var(--gold); }
  .rank-score { font-weight: 800; color: var(--navy); }

  /* ‚îÄ‚îÄ‚îÄ SCREEN VISIBILITY ‚îÄ‚îÄ‚îÄ */
  .screen { display: none; }
  .screen.active { display: block; animation: fadeUp 0.4s ease both; }

  @media (max-width: 800px) {
    .host-layout { flex-direction: column; }
    .host-qr { width: 100%; }
  }
  @media (max-width: 600px) {
    .card { padding: 28px 22px; }
    .home-hex { display: none; }
    .tf-options { flex-direction: column; }
    .btn-primary, .btn-gold { min-width: 100%; }
    .btn-row { flex-direction: column; }
  }
</style>
</head>
<body>

<div class="hex-bg">
  <svg width="500" height="500" style="top:-100px; right:-150px;" viewBox="0 0 200 200">
    <polygon points="100,0 173,50 173,150 100,200 27,150 27,50" fill="none" stroke="#003366" stroke-width="1.5"/>
    <polygon points="100,20 158,55 158,145 100,180 42,145 42,55" fill="none" stroke="#003366" stroke-width="1"/>
  </svg>
</div>

<div class="card" id="main-card">

  <div id="screen-home" class="screen active">
    <div class="logo-area">
	<img src="gdlogo.png" alt="Logo G√®nes Diffusion" class="brand-logo">

        <div class="home-badge">Formation Administrateurs</div>
	
    </div>

    <div class="home-hero">
      <div class="home-content">
        <h1 class="screen-title">Quiz de Rappel</h1>
        <div class="screen-subtitle">Finances & Structure de Groupe</div>
        
        <div class="home-meta">
          <div class="home-meta-item"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#C5A059" stroke-width="2.5"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>11 questions</div>
          <div class="home-meta-item"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#C5A059" stroke-width="2.5"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>Comp√©tition Live</div>
        </div>

        <div class="name-input-container">
          <input type="text" id="player-name" class="name-input" placeholder="Entrez votre Pr√©nom ou Pseudo" required>
        </div>

        <button class="btn-gold" onclick="startQuiz()">
          Rejoindre le Quiz
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
        </button>
      </div>
      <div class="home-hex">
        <svg width="160" height="160" viewBox="0 0 160 160" fill="none">
	  <polygon points="80,8 145,44 145,116 80,152 15,116 15,44" fill="rgba(0,51,102,0.06)" stroke="#003366" stroke-width="2"/>
          <polygon points="80,26 128,54 128,106 80,134 32,106 32,54" fill="rgba(197,160,89,0.08)" stroke="#C5A059" stroke-width="1.5"/>
          <text x="80" y="76" text-anchor="middle" font-family="Montserrat,sans-serif" font-weight="800" font-size="28" fill="#003366">11</text>
          <text x="80" y="100" text-anchor="middle" font-family="Montserrat,sans-serif" font-weight="600" font-size="13" fill="#C5A059">QUESTIONS</text>
        </svg>
      </div>
    </div>
  </div>

  <div id="screen-host" class="screen">
    <div class="logo-area">
	<img src="gdlogo.png" alt="Logo G√®nes Diffusion" class="brand-logo">
      <div class="brand-text">
        <span class="brand-genes">TABLEAU DE BORD LIVE</span>
        <span class="brand-diffusion" style="color:var(--navy);">Challenge Administrateurs</span>
      </div>
    </div>

    <div class="host-layout">
      <div class="host-leaderboard">
        <h2 class="screen-title" style="margin-bottom: 20px;">üèÜ Classement en direct</h2>
        <div id="host-leaderboard-list">
          <p style="color: #7a8aaa; font-style: italic;">En attente de la fin des parties...</p>
        </div>
      </div>
      <div class="host-qr">
        <p style="margin-bottom: 15px; font-size: 18px;">Rejoignez le Quiz !</p>
        <div id="qr-code-container"></div>
        <p style="margin-top: 15px; font-size: 14px; color: #7a8aaa;">Scannez avec votre smartphone</p>
      </div>
    </div>
  </div>

  <div id="screen-question" class="screen">
    <div class="progress-wrap">
      <div class="progress-label">
        <span id="q-label">Question 1 / 11</span>
      </div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill" style="width:0%"></div></div>
    </div>

    <div class="question-text" id="question-text"></div>

    <div class="options" id="options-container"></div>
    <div class="tf-options" id="tf-container" style="display:none;"></div>

    <div class="feedback-box" id="feedback-box">
      <div class="feedback-title" id="feedback-title"></div>
      <div id="feedback-text"></div>
    </div>

    <div class="btn-row">
      <button class="btn-primary" id="btn-next" style="display:none;" onclick="nextQuestion()">
        <span id="btn-next-label">Question suivante</span>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M5 12h14M12 5l7 7-7 7"/></svg>
      </button>
    </div>
  </div>

  <div id="screen-final" class="screen">
    <div class="score-circle">
      <svg viewBox="0 0 160 160">
        <circle cx="80" cy="80" r="68" fill="none" stroke="#e0e4ed" stroke-width="10"/>
        <circle cx="80" cy="80" r="68" fill="none" stroke="url(#scoreGrad)" stroke-width="10" stroke-linecap="round" stroke-dasharray="427" id="score-arc" stroke-dashoffset="427"/>
        <defs><linearGradient id="scoreGrad" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#003366"/><stop offset="100%" stop-color="#C5A059"/></linearGradient></defs>
      </svg>
      <div class="score-number" id="final-score-num">0</div>
      <div class="score-total" id="final-score-total">/ 11</div>
    </div>

    <div class="score-message" id="final-message">Score enregistr√© !</div>
    <div class="score-sub" id="final-sub">Regardez l'√©cran principal pour voir votre classement.</div>

    <div class="btn-row" style="justify-content:center; margin-top:30px;">
      <button class="btn-gold" onclick="location.reload()">Rejouer</button>
    </div>
  </div>

</div>

<script>
// ==========================================
// ‚ö†Ô∏è 1. CONFIGURATION FIREBASE √Ä REMPLIR
// ==========================================
const firebaseConfig = {
    apiKey: "AIzaSyBCL3VrdkXYSu4s6kqc08XaEWtiCz8F8Xg",
  authDomain: "quizadmgd.firebaseapp.com",
  databaseURL: "https://quizadmgd-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "quizadmgd",
  storageBucket: "quizadmgd.firebasestorage.app",
  messagingSenderId: "748790873744",
  appId: "1:748790873744:web:ba74124026960882a12215",
  measurementId: "G-GK48SFKGJZ"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ==========================================
// 2. DONN√âES DU QUIZ 
// ==========================================
const QUESTIONS = [
  { text: "Concernant le bilan comptable, laquelle de ces affirmations est <strong>inexacte</strong> ?", type: "mcq", options: ["C'est une photo du patrimoine de l'entreprise √† un instant T", "L'actif est √©gal au passif, sauf en cas de distribution de ristournes", "L'actif repr√©sente ce que poss√®de l'entreprise"], correct: 1, explanation: "L'actif est <em>toujours</em> √©gal au passif, c'est un principe fondamental de la comptabilit√©." },
  { text: "Concernant le lien entre les d√©cisions de gestion et le BFR, quelle affirmation est <strong>vraie</strong> ?", type: "mcq", options: ["Investir dans du mat√©riel impacte directement le BFR", "Accro√Ætre ses stocks augmente le BFR", "Le d√©lai accord√© par les fournisseurs n'a pas d'incidence sur le BFR"], correct: 1, explanation: "Augmenter ses stocks accro√Æt le BFR car cela immobilise de la tr√©sorerie dans le cycle d'exploitation." },
  { text: "Vrai ou Faux ? Le BFR est la somme d'argent n√©cessaire √† l'entreprise pour financer son cycle d'exploitation.", type: "truefalse", correct: true, explanation: "Vrai. Le BFR repr√©sente le d√©calage de tr√©sorerie entre les d√©caissements et les encaissements." },
  { text: "Ratio d'Ind√©pendance Financi√®re chez GD en 2022 : sans dettes financi√®res, quelle √©tait la valeur du ratio <em>Capitaux propres / Capitaux permanents</em> ?", type: "mcq", options: ["50%", "75%", "100%"], correct: 2, explanation: "Sans dettes financi√®res, les capitaux permanents = capitaux propres. Le ratio est donc de 100%." },
  { text: "Ratio d'Autonomie Financi√®re chez GD en 2022 : ce ratio <em>Capitaux propres / Total du bilan</em> √©tait d'environ :", type: "mcq", options: ["20%", "50%", "75%"], correct: 2, explanation: "En 2022, GD pr√©sentait une autonomie financi√®re d'environ 75%." },
  { text: "Si le ratio <em>Dettes / Capitaux propres</em> (Gearing) est <strong>sup√©rieur √† 1</strong>, l'entreprise :", type: "mcq", options: ["A plus de marge de man≈ìuvre externe", "Est en excellente sant√© financi√®re", "A des dettes sup√©rieures √† ses fonds propres"], correct: 2, explanation: "Un gearing > 1 signifie que les dettes d√©passent les fonds propres, indiquant un levier financier (et un risque) √©lev√©." },
  { text: "Combien de <strong>cat√©gories de parts sociales</strong> peuvent composer le capital d'une coop√©rative agricole ?", type: "mcq", options: ["2", "3", "4"], correct: 2, explanation: "4 cat√©gories : parts d'activit√©, parts d'associ√©s non-coop√©rateurs, parts d'√©pargne et parts √† avantages particuliers." },
  { text: "Contr√¥le exclusif : quelle d√©finition est correcte ?", type: "mcq", options: ["D√©tenir plus de 50% des droits de vote", "D√©tenir plus de 40% des droits de vote si aucun autre n'en d√©tient plus", "Les deux d√©finitions pr√©c√©dentes sont exactes"], correct: 2, explanation: "Les deux cas peuvent caract√©riser un contr√¥le exclusif." },
  { text: "Qu'est-ce qui d√©termine le <strong>type de contr√¥le</strong> exerc√© par une soci√©t√© m√®re sur sa filiale ?", type: "mcq", options: ["Le nombre de salari√©s dans la filiale", "Les droits de vote d√©tenus en assembl√©e", "Le montant total investi"], correct: 1, explanation: "C'est bien la d√©tention de droits de vote en assembl√©e qui d√©finit le type de contr√¥le." },
  { text: "Contr√¥le conjoint : quelle est la m√©thode de consolidation comptable associ√©e ?", type: "mcq", options: ["Int√©gration globale", "Int√©gration proportionnelle", "Mise en √©quivalence"], correct: 1, explanation: "Le contr√¥le conjoint correspond √† l'int√©gration proportionnelle." },
  { text: "Influence notable (d√®s 20% des droits de vote) : quelle est la m√©thode de consolidation ?", type: "mcq", options: ["Int√©gration globale", "Int√©gration proportionnelle", "Mise en √©quivalence"], correct: 2, explanation: "L'influence notable donne lieu √† la mise en √©quivalence." }
];

let current = 0;
let score = 0;
let playerName = "";
let answered = false;

// ==========================================
// 3. D√âTECTION DU MODE PR√âSENTATEUR
// ==========================================
const isHost = new URLSearchParams(window.location.search).get('view') === 'host';

if (isHost) {
  document.getElementById('main-card').classList.add('host-mode');
  showScreen('screen-host');
  
  // G√©n√©rer QR Code pointant vers l'URL sans "?view=host"
  const playerURL = window.location.href.split('?')[0];
  document.getElementById('qr-code-container').innerHTML = `<img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent(playerURL)}" alt="QR Code">`;
  
  // √âcouter les scores sur Firebase
  db.ref('leaderboard_gd').orderByChild('score').limitToLast(10).on('value', (snapshot) => {
    const listDiv = document.getElementById('host-leaderboard-list');
    listDiv.innerHTML = "";
    let data = [];
    snapshot.forEach(child => { data.push(child.val()); });
    data.reverse(); // Trier du plus grand au plus petit

    if(data.length === 0) {
        listDiv.innerHTML = '<p style="color: #7a8aaa; font-style: italic;">En attente des premiers r√©sultats...</p>';
    }

    data.forEach((entry, i) => {
      const item = document.createElement('div');
      item.className = `rank-item ${i === 0 ? 'top-1' : ''}`;
      const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : `#${i+1}`;
      item.innerHTML = `
        <div><span class="rank-pos">${medal}</span> <span>${entry.name}</span></div>
        <div class="rank-score">${entry.score} / 11</div>
      `;
      listDiv.appendChild(item);
    });
  });
}

// ==========================================
// 4. LOGIQUE DU JEU (C√îT√â JOUEUR)
// ==========================================
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function startQuiz() {
  playerName = document.getElementById('player-name').value.trim();
  if (!playerName) {
    alert("Veuillez entrer votre pr√©nom pour le classement !");
    document.getElementById('player-name').focus();
    return;
  }
  
  current = 0; score = 0; answered = false;
  showScreen('screen-question');
  renderQuestion();
}

function renderQuestion() {
  answered = false;
  const q = QUESTIONS[current];
  document.getElementById('q-label').textContent = `Question ${current + 1} / ${QUESTIONS.length}`;
  document.getElementById('progress-fill').style.width = `${(current / QUESTIONS.length) * 100}%`;
  document.getElementById('question-text').innerHTML = q.text;

  const optDiv = document.getElementById('options-container');
  const tfDiv = document.getElementById('tf-container');
  optDiv.innerHTML = '';
  tfDiv.innerHTML = '';
  tfDiv.style.display = 'none';
  optDiv.style.display = 'flex';

  const fb = document.getElementById('feedback-box');
  fb.className = 'feedback-box';
  document.getElementById('btn-next').style.display = 'none';

  if (q.type === 'truefalse') {
    optDiv.style.display = 'none';
    tfDiv.style.display = 'flex';
    ['Vrai ‚úì', 'Faux ‚úó'].forEach((label, i) => {
      const btn = document.createElement('button');
      btn.className = 'tf-btn';
      btn.innerHTML = label;
      btn.onclick = () => handleAnswer(i === 0, btn, true);
      tfDiv.appendChild(btn);
    });
  } else {
    const labels = ['A', 'B', 'C', 'D'];
    q.options.forEach((opt, i) => {
      const btn = document.createElement('button');
      btn.className = 'option-btn';
      btn.innerHTML = `<span class="option-label">${labels[i]}</span>${opt}`;
      btn.onclick = () => handleAnswer(i, btn, false);
      optDiv.appendChild(btn);
    });
  }
}

function handleAnswer(val, btn, isTF) {
  if (answered) return;
  answered = true;
  const q = QUESTIONS[current];
  const isCorrect = val === q.correct;

  if (isCorrect) score++;

  if (isTF) {
    document.querySelectorAll('.tf-btn').forEach(b => {
      b.disabled = true;
      if (b === btn) b.classList.add(isCorrect ? 'correct' : 'wrong');
      else if (!isCorrect) {
        if ((b.innerHTML.startsWith('Vrai') && q.correct === true) || (b.innerHTML.startsWith('Faux') && q.correct === false)) {
          b.classList.add('correct');
        }
      }
    });
  } else {
    document.querySelectorAll('.option-btn').forEach((b, i) => {
      b.disabled = true;
      if (i === q.correct) b.classList.add('correct');
      else if (i === val && !isCorrect) b.classList.add('wrong');
    });
  }

  showFeedback(isCorrect, q.explanation);
  
  const nextBtn = document.getElementById('btn-next');
  nextBtn.style.display = 'inline-flex';
  document.getElementById('btn-next-label').textContent = current < QUESTIONS.length - 1 ? 'Question suivante' : 'Voir mon r√©sultat';
}

function showFeedback(isCorrect, explanation) {
  const box = document.getElementById('feedback-box');
  box.className = 'feedback-box show ' + (isCorrect ? 'correct-fb' : 'wrong-fb');
  document.getElementById('feedback-title').innerHTML = isCorrect ? '‚úÖ Bonne r√©ponse !' : '‚ùå R√©ponse incorrecte';
  document.getElementById('feedback-text').innerHTML = explanation;
}

function nextQuestion() {
  current++;
  if (current >= QUESTIONS.length) {
    showFinal();
  } else {
    renderQuestion();
  }
}

function showFinal() {
  showScreen('screen-final');

  // Animation Score
  const pct = score / QUESTIONS.length;
  const circumference = 427;
  const arc = document.getElementById('score-arc');
  setTimeout(() => {
    arc.style.transition = 'stroke-dashoffset 1.2s cubic-bezier(.4,0,.2,1)';
    arc.style.strokeDashoffset = circumference - (circumference * pct);
  }, 100);

  document.getElementById('final-score-num').textContent = score;

  // üî¥ ENVOI √Ä FIREBASE
  db.ref('leaderboard_gd').push({
    name: playerName,
    score: score,
    timestamp: Date.now()
  });
}
</script>
</body>
</html>